<html>



<head>

    <script src="f1web.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <script type="text/javascript"
        src="//cdn.jsdelivr.net/gh/clappr/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>
</head>

<body>
    <select name="Season" id="seasonSelect"></select>
    <select name="Event" id="eventSelect"></select>
    <select name="Session" id="sessionSelect"></select>
    <select name="Stream" id="streamSelect"></select>
    <div id="player"></div>
    <script>
        var width = window.innerWidth * .8;
        var height = window.innerHeight * .8;
        var player = new Clappr.Player({
            width: "100%",
            height: "100%",
            parentId: "#player",
            autoPlay: false,
            mimeType: 'application/x-mpegURL',
            plugins: [LevelSelector]
        });
    </script>

    <script>

        var array = seasonsToArray();
        var select = document.getElementById("seasonSelect");
        select.setAttribute("size", array.length);
        for (var x = 0; x < array.length; x++) {
            var opt = document.createElement('option');
            //opt.appendChild(array[x]);
            opt.innerHTML = array[x].self;
            opt.object = array[x];
            select.appendChild(opt);
        }
        select.setAttribute("onchange", "updateEvents()");
        //     document.body.appendChild(select);
        function updateEvents() {
            disableSelects();

            var eventSelect = document.getElementById("eventSelect");
            var seasonSelect = document.getElementById("seasonSelect");
            console.log(seasonSelect.selectedIndex);
            var eventoccurrence_urls = seasonSelect[seasonSelect.selectedIndex].object.eventoccurrence_urls;
            var array = eventsToArray(eventoccurrence_urls);
            removeOptions(eventSelect);
            eventSelect.setAttribute("size", array.length);
            for (var x = 0; x < array.length; x++) {
                var opt = document.createElement('option');

                opt.innerHTML = array[x].self;
                opt.object = array[x];
                eventSelect.appendChild(opt);
            }
            eventSelect.setAttribute("onchange", "updateSessions()");

            enableSelects();

        }
        function updateSessions() {
            disableSelects();

            var sessionSelect = document.getElementById("sessionSelect");
            var eventSelect = document.getElementById("eventSelect");
            var sessionoccurrence_urls = eventSelect[eventSelect.selectedIndex].object.sessionoccurrence_urls;
            var array = sessionsToArray(sessionoccurrence_urls);
            removeOptions(sessionSelect);
            sessionSelect.setAttribute("size", array.length);
            for (var x = 0; x < array.length; x++) {
                var opt = document.createElement('option');
                opt.innerHTML = array[x].self;
                opt.object = array[x];
                sessionSelect.appendChild(opt);
            }
            sessionSelect.setAttribute("onchange", "updateStreams()")

            enableSelects();

        }
        function updateStreams() {
            disableSelects();

            var streamSelect = document.getElementById("streamSelect");
            var sessionSelect = document.getElementById("sessionSelect");

            var sessionSlug = sessionSelect[sessionSelect.selectedIndex].object.slug;
            var array = sessionStreamsToArray(sessionSlug);
            removeOptions(streamSelect);
            streamSelect.setAttribute("size", array.length);
            if (array.length === 0) {
                return;
            } else if (array.length === 1) {
                changeSource(array[0].blob);
                return;
            }
            for (var x = 0; x < array.length; x++) {
                var opt = document.createElement('option');
                opt.innerHTML = array[x].self;
                opt.object = array[x];
                streamSelect.appendChild(opt);
            }
            streamSelect.setAttribute("onchange", "changeStream()");

            enableSelects();
        }
        function changeStream() {
            disableSelects();
            
            var streamSelect = document.getElementById("streamSelect");
            var blob = streamSelect[streamSelect.selectedIndex].object.blob;
            changeSource(blob);

            enableSelects();
        }
        function disableSelects(){
            var seasonSelect = document.getElementById("seasonSelect");
            var eventSelect = document.getElementById("eventSelect");
            var sessionSelect = document.getElementById("sessionSelect");
            var streamSelect = document.getElementById("streamSelect");
            seasonSelect.disabled = true;
            eventSelect.disabled = true;
            sessionSelect.disabled = true;
            streamSelect.disabled = true;
        }
        function enableSelects(){
            var seasonSelect = document.getElementById("seasonSelect");
            var eventSelect = document.getElementById("eventSelect");
            var sessionSelect = document.getElementById("sessionSelect");
            var streamSelect = document.getElementById("streamSelect");
            seasonSelect.disabled = false;
            eventSelect.disabled = false;
            sessionSelect.disabled = false;
            streamSelect.disabled = false;
        }



        function removeOptions(selectbox) {
            var i;
            for (i = selectbox.options.length - 1; i >= 0; i--) {
                selectbox.remove(i);
            }
        }
    </script>
    <script>
        function changeSource(sourceString) {
            console.log("Switching to : " + sourceString)
            console.log(player.core.getCurrentPlayback().name);
            player.configure({

                source: sourceString,
                autoPlay: true,
                mimeType: 'application/x-mpegURL',


            })

        }

    </script>

</body>

</html>